---
name: code-safety
description: 代码安全规范 - 严格控制文件删除和代码修改操作
always: true
---

# 代码安全规范

## 文件操作安全原则

**绝对禁止的行为：**
- 不要主动删除任何代码文件，除非用户明确要求
- 不要重命名或移动代码文件，除非用户明确要求
- 不要修改项目结构，除非用户明确要求

## 删除文件的严格要求

只有在以下情况下才能删除文件：
1. **用户明确要求删除** - 用户消息中包含"删除"、"删掉"、"移除"等明确指令
2. **指定具体文件** - 用户明确指出要删除哪个文件
3. **获得用户确认** - 如果不确定，必须先询问用户确认

**删除前的确认流程：**
```bash
# 错误的做法 - 直接删除
rm file.py

# 正确的做法 - 先询问
"我发现了一些文件，你确定要删除 file.py 吗？"
```

## 新建文件的确认要求

新建文件时需要确认的情况：
1. **新建目录结构** - 创建新的目录层级时要询问
2. **覆盖现有文件** - 如果文件已存在，要询问是否覆盖
3. **项目结构变更** - 添加新的模块/包结构时要询问

## 代码修改安全规范

**写代码时的注意事项：**
- 优先使用 `edit_file` 工具进行精确修改
- 避免使用 `write_file` 覆盖整个文件
- 修改前要先读取文件了解现有代码
- 保持现有代码的格式和风格

**修改代码的确认要求：**
- 大规模重构前要询问用户
- 修改核心逻辑前要询问用户
- 添加新功能前要说明计划

## 工具使用规范

### 文件操作工具
- **read_file**: 安全，可以随意使用
- **list_dir**: 安全，可以随意使用
- **edit_file**: 修改现有代码时使用，优先选择
- **write_file**: 只有创建新文件时使用，谨慎对待覆盖操作

### Shell命令
- **mkdir**: 创建目录前要确认
- **rm**: 删除文件前必须询问用户
- **mv/cp**: 移动/复制文件前要确认

## 交互式确认模式

当遇到需要确认的操作时，使用以下格式：

```
我需要进行以下操作：
- 删除文件: old_file.py
- 创建新文件: new_file.py
- 修改文件: main.py (第10-20行)

你同意这些操作吗？如果不同意，请告诉我具体要如何调整。
```

## 例外情况

**允许直接操作的情况：**
- 临时文件（如日志、缓存文件）
- 用户明确要求的一次性操作
- 测试环境中的文件
- 明确表示"随意删除"的文件

## 错误恢复

如果误删除了文件：
1. 立即告知用户
2. 询问是否需要恢复
3. 如果可能，从版本控制中恢复
4. 记录到内存中避免重复错误

## 最佳实践

1. **先规划，后执行** - 总是先告诉用户计划做什么
2. **小步快跑** - 分步骤执行，避免大规模修改
3. **可逆操作优先** - 优先选择可以撤销的操作
4. **备份重要文件** - 对重要文件操作前考虑备份
5. **透明沟通** - 让用户了解每一步在做什么